#Examples

## Base Job Builder

```
import jenkins.automation.builders.BaseJobBuilder
   
new BaseJobBuilder(
     name: "sample-job",
     description: "Description of your job",
     emails: ["foo@example.com","bar@example.com"] 
).build(this)
```

## Checkmarx Security Job Builder

```
import jenkins.automation.builders.CheckmarxSecurityJobBuilder

def groupId = "your-group-id"  
def projectName ='sample-project'
new CheckmarxSecurityJobBuilder(
        name: "${projectName}-checkmarx",
        description: "Sample checkmarx security job",
        useOwnServerCredentials: false,
        serverUrl: "http://sample-serverUrl",
        username: "sample-username",
        password: "sample-password",
        groupId: "${groupId}",
        scanRepo: "https://github.com/OrlandoSoto/ckan-browser-tests",
        checkmarxComment: "Generated by Checkmarx job builder JAC",
        vulnerabilityThresholdEnabled: true,
        highThreshold: "1",
        mediumThreshold: "2",
        lowThreshold: "3",
        cleanWorkspace: true // Clean up the workspace before every checkout
).build(this)
```

## BDD Security Job Builder

```
import jenkins.automation.builders.BddSecurityJobBuilder
   
def projectName ='sample-project'
def bddSecurityRepo ="repo-to-scan'
new BddSecurityJobBuilder(
       name: "${projectName}-bdd-security-job",
       description: "Sample bdd security job",
       baseUrl: "http://google.com",
       bddSecurityRepo: "${bddSecurityRepo}",
       chromedriverPath: "\\/Users\\/sotoo\\/homebrew\\/bin\\/Chromedriver"
).build(this)
```

## Flow Job Builder

```
import jenkins.automation.builders.FlowJobBuilder

new FlowJobBuilder(
        name: 'sample-flow-job',
        description: 'A sample build flow job that builds a list of jobs in order',
        jobs:['job1', 'job2']
).build(this).with {
  logRotator{
      numToKeep(365)
  }
}

new FlowJobBuilder(
        name: 'sample-flow-job-with-build-flow',
        description: 'A sample build flow job that takes a jobFlow string, for full control',
        jobFlow: """
            build('job1')
            build('job2')
            parallel(
             { build('job3') },
             { build('job4') },
            )
        """
).build(this).with {
  logRotator{
      numToKeep(365)
  }
}
```

## JS Build Job

```
import jenkins.automation.builders.JsJobBuilder

String basePath = 'JsJobSamples'
List developers = ['irina.muchnik@cfpb.gov', 'daniel.davis@cfpb.gov']

def repos = [
        [name: 'jenkins-automation', url: "https://github.com/cfpb/jenkins-automation@2.0"],
        [name: 'collab', url: "https://github.com/cfpb/collab"]
        [name: 'other', url: "https://github.com/cfpb/jenkins-automation", disable_submodule: true]
]
folder(basePath) {
    description 'This example shows how to create jobs using Job builders.'
}

new JsJobBuilder(
        name: "$basePath/BuilderVsBuilders",
        description: 'An example using a job builder for a Javascript build jobs project',
        repos: repos,
        emails: developers,
        use_versions: true
).build(this)
```

## Using MultiScm Utility 

```
import jenkins.automation.builders.BaseJobBuilder
import jenkins.automation.utils.ScmUtils

def repos = [
        [name: 'jenkins-automation', url: "https://github.com/cfpb/jenkins-automation@2.0"],
        [name: 'collab', url: "https://github.com/cfpb/collab"]
]
new BaseJobBuilder(
        name: "sample-job-with-multiscm",
        description: "A sample with multiple source control repositories",
).build(this).with {
    multiscm {
        ScmUtils.project_repos(delegate, repos, true)
    }
}
```

## Determining the environment

```
import jenkins.automation.utils.EnvironmentUtils

// In our Jenkinses, we name this variable "JAC_ENVIRONMENT" with values of "DEV", "STAGE", or "PROD"
// In your Jenkins, you can name the variable whatever you like; replace the variable you pass into 
// EnvironmentUtils.getInstance(...) with your global variable name

def env = EnvironmentUtils.getInstance("${JAC_ENVIRONMENT}")
println "Environment is " + env.getEnv()

if (env.isDev()){
    // Do environment-specific things here
}

job('test') {
    steps {
        shell "echo ${env.getEnv()}"
    }
}

```

## Common Utils

### Defaults

```
import jenkins.automation.utils.CommonUtils

job('example'){
    CommonUtils.addDefaults(delegate)
}
```

### Extended Email

```
import jenkins.automation.utils.CommonUtils

job("example"){
    CommonUtils.addExtendedEmail(delegate, emails = 'foo@example.com, bar@example.com') 
}
   
// override accepts emails as a list. Compatible with builders
job('example'){
    CommonUtils.addExtendedEmail(delegate, emails = ['foo@example.com', 'bar@example.com']) 
}
```

### Inject global passwords

```
import jenkins.automation.builders.BaseJobBuilder
import jenkins.automation.utils.CommonUtils

new BaseJobBuilder(
        name: "sample-base-job-with-additional-config",
        description: "A job with some additional configurations added"
).build(this).with {
    CommonUtils.addInjectGlobalPasswords(delegate)
}
```

### Add shell parsing rules

```
import jenkins.automation.builders.BaseJobBuilder
import jenkins.automation.utils.CommonUtils

new BaseJobBuilder(
        name: "sample-base-job-with-log-parsing",
        description: "A job with log parsing added"
).build(this).with {
    //how to use CommonUtils; pass a custom filename to override the default
    CommonUtils.addLogParserPublisher(delegate, "/var/lib/jenkins/some_rules_file.txt")
}
```

### Add virtualenv to a shell step

```
import jenkins.automation.builders.BaseJobBuilder
import jenkins.automation.utils.CommonUtils

new BaseJobBuilder(
        name: "sample-base-job-with-virtualenv",
        description: "A job that creates and activates a python 2.7 virtualenv"
).build(this).with {
    steps {
        shell( CommonUtils.python27Virtualenv + """
                # pip install ansible
                ls -la
                env
                echo "Hello world"
            """.stripIndent()
        )
    }
}
```

### Add a performance publisher block

```
import jenkins.automation.builders.BaseJobBuilder
import jenkins.automation.utils.CommonUtils

new BaseJobBuilder(
        name: "sample-base-job-with-performance-publisher",
        description: "A job with a performance publisher. It does not include the actual bits that run the load tests"
).build(this).with {
    steps {
        shell("echo 'Run jmeter tests here'")
    }
    CommonUtils.addPerformancePublisher(delegate)
}
```